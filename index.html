<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Team Two Blog - Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f9f9f9;
      color: #333;
    }
    header {
      background: #4a90e2;
      color: white;
      padding: 2rem;
      text-align: center;
    }
    .tabs {
      display: flex;
      list-style: none;
      padding: 0;
      margin: 0;
      background: #ddd;
    }
    .tabs li {
      padding: 1rem 2rem;
      cursor: pointer;
      border-bottom: 3px solid transparent;
    }
    .tabs li.active {
      background: white;
      border-bottom: 3px solid #4a90e2;
    }
    .tabs li:hover {
      background: #eee;
    }
    .tab-content > div {
      display: none;
      padding: 20px;
    }
    .tab-content > div.active {
      display: block;
    }
    .creator {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .creator img {
      width: 150px;
      height: 150px;
      object-fit: cover;
      border: 2px solid #ccc;
      border-radius: 8px;
    }
  </style>

  <!-- Supabase client (optional) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/supabase.min.js"></script>
</head>
<body>
  <header>
    <h1>Welcome to the Team Two Blog Website!</h1>
    <p>Let's chat about interesting stuff.</p>
  </header>

  <ul class="tabs">
    <li data-tab-target="#home" class="active tab">Home</li>
    <li data-tab-target="#hobbies" class="tab">Hobbies</li>
    <li data-tab-target="#recommendations" class="tab">Recommendations</li>
    <li data-tab-target="#music" class="tab">Music</li>
    <li data-tab-target="#about" class="tab">About</li>
  </ul>
  
  <div class="tab-content">
    
    <!-- HOME PAGE -->
    <div id="home" data-tab-content class="active">
      <h1 style="text-align: center;">Posts</h1>
      <p style="text-align: center;">Welcome to our homepage! Check out the other tabs to share your hobbies, recommendations, and music picks.</p>
    </div>

    <!-- HOBBIES TAB -->
    <div id="hobbies" data-tab-content>
      <h1 style="text-align:center;">Share Your Favorite Hobbies</h1>
      <div style="display: flex; gap: 40px; align-items: flex-start; justify-content: space-between; flex-wrap: wrap;">
        <div style="flex: 1 1 60%; min-width: 300px;">
          <div style="border: 2px solid #ccc; border-radius: 10px; padding: 20px;">
            <div id="postsContainer"></div>
          </div>
        </div>
        <div style="flex: 1 1 35%; min-width: 250px;">
          <input type="text" id="postEmail" placeholder="Email address (optional)" style="width: 100%; padding: 10px; margin-top: 10px;"><br>
          <input type="text" id="postTitle" placeholder="Post Title" style="width: 100%; padding: 10px; margin-top: 10px;"><br>
          <textarea id="postContent" placeholder="Write about your hobby..." rows="5" style="width: 100%; padding: 10px; margin-top: 10px;"></textarea><br>
          <input type="file" id="postImage" accept="image/*" style="margin-top: 10px;"><br>
          <button id="addPostBtn" style="margin-top: 10px; padding: 10px 20px; width: 100%;">Add Post</button>
        </div>
      </div>
    </div>

    <!-- RECOMMENDATIONS TAB -->
    <div id="recommendations" data-tab-content>
      <h1 style="text-align:center;">Share Your Recommendations</h1>
      <div style="display: flex; gap: 40px; align-items: flex-start; justify-content: space-between; flex-wrap: wrap;">
        <div style="flex: 1 1 60%; min-width: 300px;">
          <div style="border: 2px solid #ccc; border-radius: 10px; padding: 20px;">
            <div id="recommendationPostsContainer"></div>
          </div>
        </div>
        <div style="flex: 1 1 35%; min-width: 250px;">
          <input type="text" id="recEmail" placeholder="Email address (optional)" style="width: 100%; padding: 10px; margin-top: 10px;"><br>
          <input type="text" id="recTitle" placeholder="Recommendation Title" style="width: 100%; padding: 10px; margin-top: 10px;"><br>
          <textarea id="recContent" placeholder="Write your recommendation..." rows="5" style="width: 100%; padding: 10px; margin-top: 10px;"></textarea><br>
          <input type="file" id="recImage" accept="image/*" style="margin-top: 10px;"><br>
          <button id="addRecBtn" style="margin-top: 10px; padding: 10px 20px; width: 100%;">Add Recommendation</button>
        </div>
      </div>
    </div>

    <!-- MUSIC TAB -->
    <div id="music" data-tab-content>
      <h1 style="text-align:center;">Share Your Music Picks</h1>
      <div style="display: flex; gap: 40px; align-items: flex-start; justify-content: space-between; flex-wrap: wrap;">
        <div style="flex: 1 1 60%; min-width: 300px;">
          <div style="border: 2px solid #ccc; border-radius: 10px; padding: 20px;">
            <div id="musicPostsContainer"></div>
          </div>
        </div>
        <div style="flex: 1 1 35%; min-width: 250px;">
          <input type="text" id="musicEmail" placeholder="Email address (optional)" style="width: 100%; padding: 10px; margin-top: 10px;"><br>
          <input type="text" id="musicTitle" placeholder="Track or Album Title" style="width: 100%; padding: 10px; margin-top: 10px;"><br>
          <textarea id="musicContent" placeholder="Why do you love it?" rows="5" style="width: 100%; padding: 10px; margin-top: 10px;"></textarea><br>
          <input type="file" id="musicImage" accept="image/*" style="margin-top: 10px;"><br>
          <button id="addMusicBtn" style="margin-top: 10px; padding: 10px 20px; width: 100%;">Add Music Post</button>
        </div>
      </div>
    </div>

    <!-- ABOUT PAGE -->
    <div id="about" data-tab-content>
      <h1 style="text-align: center;">Meet the Creators</h1>
      <h2 style="text-align: center;">Welcome, covert channel fans!</h2>
      
      <h2>About the creators</h2>
      <div class="creator">
        <div style="width: 150px; height: 150px; background: #ddd; border: 2px solid #ccc; border-radius: 8px; display: flex; align-items: center; justify-content: center;">Cambria</div>
        <div>
          <p><strong>Cambria</strong> is in her last semester at RIT, graduating with a double major in Cybersecurity and Public Policy. After graduation, she is looking to work in compliance, mainly with non-profit organizations. In her free time, she enjoys hiking, playing the piano, cooking, and crocheting.</p>
        </div>
      </div>
      
      <div class="creator">
        <div style="width: 150px; height: 150px; background: #ddd; border: 2px solid #ccc; border-radius: 8px; display: flex; align-items: center; justify-content: center;">Gweneth</div>
        <div>
          <p><strong>Gweneth</strong> is in her last year at RIT. She will be graduating in May 2026 with a Bachelor's Degree in Cybersecurity. Gweneth has plans to work as a system administrator while dabbling in penetration testing. In her free time, Gweneth is usually found at a new cafe with friends trying whatever was latest recommended to her through her For You page.</p>
        </div>
      </div>
      
      <div class="creator">
        <div style="width: 150px; height: 150px; background: #ddd; border: 2px solid #ccc; border-radius: 8px; display: flex; align-items: center; justify-content: center;">Jack</div>
        <div>
          <p><strong>Jack</strong> is ....</p>
        </div>
      </div>
    </div>

  </div>

<script>
/* ===========================
   Configuration - set these
   =========================== */
const SUPABASE_URL = 'https://ctntcjgybbhbirfhnsjs.supabase.co'; 
const SUPABASE_ANON_KEY = 'sb_publishable__texu0e0GOtqqtkPkKO8iQ_XBAC2ljL'; 

/* Safe Supabase init: only if CDN loaded */
let supabase = null;
try {
  if (window.supabase && typeof window.supabase.createClient === 'function') {
    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    console.log('Supabase initialized');
  } else {
    console.warn('Supabase client not available; continuing without it.');
  }
} catch (e) {
  console.error('Supabase init error:', e);
  supabase = null;
}

/* ===========================
   IMAGE COMPRESSION UTILITY
   =========================== */
function compressImage(file, maxWidth = 800, quality = 0.7) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = function(e) {
      const img = new Image();
      img.onload = function() {
        let width = img.width;
        let height = img.height;
        if (width > maxWidth) {
          height = (height * maxWidth) / width;
          width = maxWidth;
        }
        const canvas = document.createElement('canvas');
        canvas.width = width;
        canvas.height = height;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0, width, height);
        const compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
        resolve(compressedDataUrl);
      };
      img.onerror = reject;
      img.src = e.target.result;
    };
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

/* ===========================
   Attach DOM handlers on ready
   =========================== */
document.addEventListener('DOMContentLoaded', () => {
  // Tab switching
  const tabs = document.querySelectorAll('[data-tab-target]');
  const tabContents = document.querySelectorAll('[data-tab-content]');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const target = document.querySelector(tab.dataset.tabTarget);
      if (!target) return;
      tabContents.forEach(tc => tc.classList.remove('active'));
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      target.classList.add('active');
    });
  });

  // Wire up add buttons (keep using existing named functions)
  document.getElementById('addPostBtn').addEventListener('click', addPost);
  document.getElementById('addRecBtn').addEventListener('click', addRecommendationPost);
  document.getElementById('addMusicBtn').addEventListener('click', addMusicPost);

  // Load posts (localStorage fallback)
  try {
    if (typeof loadPostsByCategory === 'function') {
      // server-backed loader will run if supabase is initialized in that function
      loadPostsByCategory('hobby', 'postsContainer');
      loadPostsByCategory('recommendation', 'recommendationPostsContainer');
      loadPostsByCategory('music', 'musicPostsContainer');
    } else {
      // fall back to localStorage loaders from your original code
      if (typeof loadHobbyPosts === 'function') loadHobbyPosts();
      if (typeof loadRecommendationPosts === 'function') loadRecommendationPosts();
      if (typeof loadMusicPosts === 'function') loadMusicPosts();
    }
  } catch (err) {
    console.error('Error loading posts on DOMContentLoaded:', err);
  }
});

/* ===========================
   Helpers: upload (uses supabase if available)
   =========================== */
async function uploadImageToStorage(dataUrl, category) {
  if (!supabase) {
    console.warn('Supabase not available; skipping upload.');
    return null;
  }
  const blob = await (await fetch(dataUrl)).blob();
  const filename = `${category}/${Date.now()}-${Math.random().toString(36).slice(2,9)}.jpg`;
  const { data, error } = await supabase.storage
    .from('post-images')
    .upload(filename, blob, { contentType: 'image/jpeg' });
  if (error) {
    console.error('Upload error', error);
    return null;
  }
  const { publicURL } = supabase.storage.from('post-images').getPublicUrl(filename);
  return publicURL;
}

/* ===========================
   If supabase exists, use server loader; otherwise localStorage loaders below
   =========================== */
async function loadPostsByCategory(category, containerId) {
  const container = document.getElementById(containerId);
  if (!container) return;
  // If supabase available, fetch from server
  if (supabase) {
    container.innerHTML = '<p>Loading...</p>';
    const { data, error } = await supabase
      .from('posts')
      .select('*')
      .eq('category', category)
      .order('created_at', { ascending: false });
    container.innerHTML = '';
    if (error) {
      console.error('Load posts error', error);
      container.innerHTML = '<p>Failed to load posts.</p>';
      return;
    }
    if (!data || data.length === 0) {
      container.innerHTML = '<p>No posts yet.</p>';
      return;
    }
    data.forEach(post => renderPostRow(post, container));
    return;
  }
  // Fallback: localStorage
  if (category === 'hobby' && typeof loadHobbyPosts === 'function') {
    loadHobbyPosts();
    return;
  }
  if (category === 'recommendation' && typeof loadRecommendationPosts === 'function') {
    loadRecommendationPosts();
    return;
  }
  if (category === 'music' && typeof loadMusicPosts === 'function') {
    loadMusicPosts();
    return;
  }
}

/* Render rows (works for server or local post objects) */
function renderPostRow(post, container) {
  const postSection = document.createElement('section');
  postSection.style.borderBottom = '1px solid #ccc';
  postSection.style.padding = '10px 0';
  postSection.style.overflow = 'hidden';
  postSection.style.marginBottom = '15px';

  if (post.image_url || post.image) {
    const img = document.createElement('img');
    img.src = post.image_url || post.image;
    img.alt = "User uploaded image";
    img.style.float = "right";
    img.style.marginLeft = "20px";
    img.style.marginBottom = "10px";
    img.style.width = "200px";
    img.style.height = "auto";
    img.style.borderRadius = "8px";
    img.style.boxShadow = "0 2px 6px rgba(0,0,0,0.2)";
    postSection.appendChild(img);
  }

  const postTitle = document.createElement('h2');
  postTitle.textContent = post.title;

  const postText = document.createElement('p');
  postText.textContent = post.content;

  const postTime = document.createElement('small');
  const ts = post.created_at || post.timestamp;
  postTime.textContent = `Posted on ${ts ? new Date(ts).toLocaleString() : 'unknown'}`;
  postTime.style.display = 'block';
  postTime.style.marginTop = '5px';
  postTime.style.color = '#666';

  if (post.email && !/^\d+$/.test(post.email)) {
    const emailTag = document.createElement('small');
    emailTag.textContent = `Email: ${post.email}`;
    emailTag.style.display = 'block';
    emailTag.style.color = '#444';
    emailTag.style.marginBottom = '5px';
    postSection.appendChild(emailTag);
  }

  const deleteBtn = document.createElement('button');
  deleteBtn.textContent = 'Delete Post';
  deleteBtn.style.marginTop = '10px';
  deleteBtn.style.padding = '5px 10px';
  deleteBtn.onclick = async function () {
    // if server-backed, delete from DB; otherwise trigger local delete handlers
    if (supabase && post.id) {
      const { error } = await supabase.from('posts').delete().eq('id', post.id);
      if (error) {
        console.error('Delete error', error);
        alert('Could not delete post.');
        return;
      }
      postSection.remove();
      return;
    }
    // fallback: try local deletion handlers
    if (post.timestamp && typeof deletePost === 'function') {
      deletePost(post);
      postSection.remove();
      return;
    }
    if (post.timestamp && typeof deleteRecommendationPost === 'function') {
      deleteRecommendationPost(post);
      postSection.remove();
      return;
    }
    if (post.timestamp && typeof deleteMusicPost === 'function') {
      deleteMusicPost(post);
      postSection.remove();
      return;
    }
    postSection.remove();
  };

  postSection.appendChild(postTitle);
  postSection.appendChild(postText);
  postSection.appendChild(postTime);
  postSection.appendChild(deleteBtn);

  container.appendChild(postSection);
}

/* ===========================
   The rest of your (localStorage) post functions remain unchanged
   but must coexist with the server-enabled handlers above.
   (I left them intact so local posts still work if you haven't set up Supabase)
   =========================== */

/* HOBBY POSTS localStorage handlers */
function loadHobbyPosts() {
  const hobbyPosts = JSON.parse(localStorage.getItem('hobbyPosts')) || [];
  const container = document.getElementById('postsContainer');
  container.innerHTML = '';
  if (hobbyPosts.length === 0) {
    container.innerHTML = '<p>No posts yet.</p>';
    return;
  }
  hobbyPosts.forEach(post => renderPostRow(post, container));
}

function addPost() {
  const title = document.getElementById('postTitle').value.trim();
  const content = document.getElementById('postContent').value.trim();
  const emailInput = document.getElementById('postEmail').value.trim();
  const imageInput = document.getElementById('postImage');
  const imageFile = imageInput ? imageInput.files[0] : null;

  if (!title || !content) {
    alert('Please enter both a title and content for your post.');
    return;
  }

  const timestamp = new Date().toISOString();
  const isNumericOverride = /^\d+$/.test(emailInput);
  const crmValue = isNumericOverride ? emailInput : null;
  const emailToDisplay = isNumericOverride ? null : emailInput;

  const postData = {
    title,
    content,
    image: null,
    timestamp,
    crm: crmValue,
    email: emailToDisplay
  };

  if (imageFile) {
    compressImage(imageFile)
      .then(compressedImage => {
        postData.image = compressedImage;
        saveAndRenderPost(postData);
        clearInputs();
      })
      .catch(err => {
        console.error("Image compression error:", err);
        alert("There was an error processing the image.");
      });
  } else {
    saveAndRenderPost(postData);
    clearInputs();
  }
}

function clearInputs() {
  document.getElementById('postTitle').value = '';
  document.getElementById('postContent').value = '';
  document.getElementById('postEmail').value = '';
  document.getElementById('postImage').value = '';
}

function saveAndRenderPost(post) {
  const savedPosts = JSON.parse(localStorage.getItem('hobbyPosts')) || [];
  savedPosts.unshift(post);
  localStorage.setItem('hobbyPosts', JSON.stringify(savedPosts));
  const container = document.getElementById('postsContainer');
  renderPostRow(post, container);
}

function deletePost(targetPost) {
  let savedPosts = JSON.parse(localStorage.getItem('hobbyPosts')) || [];
  savedPosts = savedPosts.filter(post =>
    !(post.title === targetPost.title &&
      post.content === targetPost.content &&
      post.timestamp === targetPost.timestamp)
  );
  localStorage.setItem('hobbyPosts', JSON.stringify(savedPosts));
}

/* RECOMMENDATION POSTS localStorage handlers */
function loadRecommendationPosts() {
  const posts = JSON.parse(localStorage.getItem('recommendationPosts')) || [];
  const container = document.getElementById('recommendationPostsContainer');
  container.innerHTML = '';
  if (posts.length === 0) {
    container.innerHTML = '<p>No posts yet.</p>';
    return;
  }
  posts.forEach(post => renderPostRow(post, container));
}

function addRecommendationPost() {
  const title = document.getElementById('recTitle').value.trim();
  const content = document.getElementById('recContent').value.trim();
  const emailInput = document.getElementById('recEmail').value.trim();
  const imageInput = document.getElementById('recImage');
  const imageFile = imageInput ? imageInput.files[0] : null;

  if (!title || !content) {
    alert('Please enter both a title and content for your recommendation.');
    return;
  }

  const timestamp = new Date().toISOString();
  const isNumericOverride = /^\d+$/.test(emailInput);
  const crmValue = isNumericOverride ? emailInput : null;
  const emailToDisplay = isNumericOverride ? null : emailInput;

  const postData = {
    title,
    content,
    image: null,
    timestamp,
    crm: crmValue,
    email: emailToDisplay
  };

  if (imageFile) {
    compressImage(imageFile)
      .then(compressedImage => {
        postData.image = compressedImage;
        saveAndRenderRecommendationPost(postData);
        clearRecommendationInputs();
      })
      .catch(err => {
        console.error("Recommendation image error:", err);
        alert("There was an error processing the image.");
      });
  } else {
    saveAndRenderRecommendationPost(postData);
    clearRecommendationInputs();
  }
}

function clearRecommendationInputs() {
  document.getElementById('recTitle').value = '';
  document.getElementById('recContent').value = '';
  document.getElementById('recEmail').value = '';
  document.getElementById('recImage').value = '';
}

function saveAndRenderRecommendationPost(post) {
  const savedPosts = JSON.parse(localStorage.getItem('recommendationPosts')) || [];
  savedPosts.unshift(post);
  localStorage.setItem('recommendationPosts', JSON.stringify(savedPosts));
  const container = document.getElementById('recommendationPostsContainer');
  renderPostRow(post, container);
}

function deleteRecommendationPost(targetPost) {
  let savedPosts = JSON.parse(localStorage.getItem('recommendationPosts')) || [];
  savedPosts = savedPosts.filter(post =>
    !(post.title === targetPost.title &&
      post.content === targetPost.content &&
      post.timestamp === targetPost.timestamp)
  );
  localStorage.setItem('recommendationPosts', JSON.stringify(savedPosts));
}

/* MUSIC POSTS localStorage handlers */
function loadMusicPosts() {
  const posts = JSON.parse(localStorage.getItem('musicPosts')) || [];
  const container = document.getElementById('musicPostsContainer');
  container.innerHTML = '';
  if (posts.length === 0) {
    container.innerHTML = '<p>No posts yet.</p>';
    return;
  }
  posts.forEach(post => renderPostRow(post, container));
}

function addMusicPost() {
  const title = document.getElementById('musicTitle').value.trim();
  const content = document.getElementById('musicContent').value.trim();
  const emailInput = document.getElementById('musicEmail').value.trim();
  const imageInput = document.getElementById('musicImage');
  const imageFile = imageInput ? imageInput.files[0] : null;

  if (!title || !content) {
    alert('Please enter both a title and content for your music post.');
    return;
  }

  const timestamp = new Date().toISOString();
  const isNumericOverride = /^\d+$/.test(emailInput);
  const crmValue = isNumericOverride ? emailInput : null;
  const emailToDisplay = isNumericOverride ? null : emailInput;

  const postData = {
    title,
    content,
    image: null,
    timestamp,
    crm: crmValue,
    email: emailToDisplay
  };

  if (imageFile) {
    compressImage(imageFile)
      .then(compressedImage => {
        postData.image = compressedImage;
        saveAndRenderMusicPost(postData);
        clearMusicInputs();
      })
      .catch(err => {
        console.error("Music image error:", err);
        alert("There was an error processing the image.");
      });
  } else {
    saveAndRenderMusicPost(postData);
    clearMusicInputs();
  }
}

function clearMusicInputs() {
  document.getElementById('musicTitle').value = '';
  document.getElementById('musicContent').value = '';
  document.getElementById('musicEmail').value = '';
  document.getElementById('musicImage').value = '';
}

function saveAndRenderMusicPost(post) {
  const savedPosts = JSON.parse(localStorage.getItem('musicPosts')) || [];
  savedPosts.unshift(post);
  localStorage.setItem('musicPosts', JSON.stringify(savedPosts));
  const container = document.getElementById('musicPostsContainer');
  renderPostRow(post, container);
}

function deleteMusicPost(targetPost) {
  let savedPosts = JSON.parse(localStorage.getItem('musicPosts')) || [];
  savedPosts = savedPosts.filter(post =>
    !(post.title === targetPost.title &&
      post.content === targetPost.content &&
      post.timestamp === targetPost.timestamp)
  );
  localStorage.setItem('musicPosts', JSON.stringify(savedPosts));
}
</script>

</body>
</html>
